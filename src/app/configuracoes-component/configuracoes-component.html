<div class="configuracoes-container">
  <div class="configuracoes-header">
    <button class="back-button" (click)="goBack()">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
      </svg>
      Voltar
    </button>
    <h1 class="page-title">Configurações</h1>
  </div>

  <div class="configuracoes-content">
    <div class="config-section">
      <h2 class="section-title">Meu Perfil</h2>
      
      <!-- Seção de Foto de Perfil -->
      <div class="profile-image-section">
        <div class="profile-image-container">
          <img 
            [src]="profileImage() || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxjaXJjbGUgY3g9IjEyIiBjeT0iMTIiIHI9IjEyIiBmaWxsPSIjRTVFN0VCIi8+PHBhdGggZD0iTTEyIDEyQzEzLjEgMTIgMTQgMTEuMSAxNCAxMEMxNCA4LjkgMTMuMSA4IDEyIDhDMTAuOSA4IDEwIDguOSAxMCAxMEMxMCAxMS4xIDEwLjkgMTIgMTIgMTJaTTEyIDE0QzkuMzMgMTQgNiAxNS4zNCA2IDE4VjIwSDE4VjE4QzE4IDE1LjY2IDE0LjY3IDE0IDEyIDE0WiIgZmlsbD0iIzlDQTNBRiIvPjwvc3ZnPg=='" 
            alt="Foto de perfil" 
            class="profile-image">
          <div class="image-overlay">
            <input 
              type="file" 
              id="imageUpload" 
              accept="image/*" 
              (change)="onImageUpload($event)"
              class="image-input">
            <label for="imageUpload" class="upload-button">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"/>
              </svg>
              Alterar
            </label>
          </div>
        </div>
        <button 
          *ngIf="profileImage()" 
          class="remove-image-button" 
          (click)="removeProfileImage()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
          </svg>
        </button>
      </div>

      <!-- Formulário Unificado -->
      <form 
        [formGroup]="settingsForm" 
        (ngSubmit)="onSubmit()" 
        class="settings-form">
        
        <!-- Campo Nome -->
        <div class="form-group">
          <label for="nome">Nome</label>
          <input 
            type="text" 
            id="nome"
            formControlName="nome"
            class="form-input"
            [class.error]="settingsForm.get('nome')?.invalid && settingsForm.get('nome')?.touched"
            placeholder="Seu nome">
          <div class="error-message" *ngIf="settingsForm.get('nome')?.invalid && settingsForm.get('nome')?.touched">
            <span *ngIf="settingsForm.get('nome')?.errors?.['required']">Nome é obrigatório</span>
            <span *ngIf="settingsForm.get('nome')?.errors?.['minlength']">Nome deve ter pelo menos 3 caracteres</span>
          </div>
        </div>

        <!-- Campo Email -->
        <div class="form-group">
          <label for="email">Email</label>
          <input 
            type="email" 
            id="email"
            formControlName="email"
            class="form-input"
            [class.error]="settingsForm.get('email')?.invalid && settingsForm.get('email')?.touched"
            placeholder="seu@email.com">
          <div class="error-message" *ngIf="settingsForm.get('email')?.invalid && settingsForm.get('email')?.touched">
            <span *ngIf="settingsForm.get('email')?.errors?.['required']">Email é obrigatório</span>
            <span *ngIf="settingsForm.get('email')?.errors?.['email']">Email inválido</span>
          </div>
        </div>

        <!-- Campos de Senha -->
        <div class="form-divider">
          <span>Alterar Senha</span>
        </div>

        <div class="form-group">
          <label for="senhaAtual">Senha Atual</label>
          <input 
            type="password" 
            id="senhaAtual"
            formControlName="senhaAtual"
            class="form-input"
            [class.error]="settingsForm.get('senhaAtual')?.invalid && (settingsForm.get('senhaAtual')?.touched || settingsForm.get('senhaAtual')?.dirty)"
            placeholder="Digite sua senha atual">
          <div class="error-message" *ngIf="settingsForm.get('senhaAtual')?.invalid && (settingsForm.get('senhaAtual')?.touched || settingsForm.get('senhaAtual')?.dirty)">
            <span *ngIf="settingsForm.get('senhaAtual')?.errors?.['required']">Senha atual é obrigatória quando alterar senha</span>
          </div>
        </div>

        <div class="form-group">
          <label for="novaSenha">Nova Senha</label>
          <input 
            type="password" 
            id="novaSenha"
            formControlName="novaSenha"
            class="form-input"
            [class.error]="settingsForm.get('novaSenha')?.invalid && (settingsForm.get('novaSenha')?.touched || settingsForm.get('novaSenha')?.dirty)"
            placeholder="Digite sua nova senha">
          <div class="error-message" *ngIf="settingsForm.get('novaSenha')?.invalid && (settingsForm.get('novaSenha')?.touched || settingsForm.get('novaSenha')?.dirty)">
            <span *ngIf="settingsForm.get('novaSenha')?.errors?.['required']">Nova senha é obrigatória quando alterar senha</span>
            <span *ngIf="settingsForm.get('novaSenha')?.errors?.['minlength']">Senha deve ter pelo menos 6 caracteres</span>
          </div>
        </div>

        <div class="form-group">
          <label for="confirmarSenha">Confirmar Nova Senha</label>
          <input 
            type="password" 
            id="confirmarSenha"
            formControlName="confirmarSenha"
            class="form-input"
            [class.error]="(settingsForm.get('confirmarSenha')?.invalid || settingsForm.errors?.['passwordMismatch']) && (settingsForm.get('confirmarSenha')?.touched || settingsForm.get('confirmarSenha')?.dirty)"
            placeholder="Confirme sua nova senha">
          <div class="error-message" *ngIf="settingsForm.get('confirmarSenha')?.invalid && (settingsForm.get('confirmarSenha')?.touched || settingsForm.get('confirmarSenha')?.dirty)">
            <span *ngIf="settingsForm.get('confirmarSenha')?.errors?.['required']">Confirmação de senha é obrigatória</span>
          </div>
          <div class="error-message" *ngIf="settingsForm.errors?.['passwordMismatch'] && (settingsForm.get('confirmarSenha')?.touched || settingsForm.get('confirmarSenha')?.dirty)">
            <span>As senhas não coincidem</span>
          </div>
        </div>

        <button type="submit" class="save-button" [disabled]="settingsForm.invalid">
          Salvar Alterações
        </button>
      </form>
    </div>

    <!-- Seção de Logout -->
    <div class="config-section danger-section">
      <h2 class="section-title">Conta</h2>
      
      <div class="danger-actions">
        <button class="logout-button" (click)="logout()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M14.08,15.59L16.67,13H7V11H16.67L14.08,8.41L15.5,7L20.5,12L15.5,17L14.08,15.59M19,3A2,2 0 0,1 21,5V9.67L19,7.67V5H5V19H19V16.33L21,14.33V19A2,2 0 0,1 19,21H5C3.89,21 3,20.1 3,19V5C3,3.89 3.89,3 5,3H19Z"/>
          </svg>
          Sair da Conta
        </button>
      </div>
    </div>
  </div>
</div>
